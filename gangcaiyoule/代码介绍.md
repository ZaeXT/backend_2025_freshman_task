## 📘 项目说明文档

### 一、项目简介

本项目是一个使用 **Golang (Gin 框架)** 编写的简易后端服务，实现了用户注册、登录、会话管理、文件上传、聊天记录保存与分享、管理员管理等功能。
 主要用于支持一个基于对话模型的应用（如聊天机器人或AI助手）的后端接口。

------

### 二、主要功能

1. **用户管理**
   - 用户注册（`/register`）
   - 用户登录（`/login`）
   - 获取用户信息（`/getUserHandler`）
   - 用户退出登录（`/logout`）
   - 会员充值接口（`/recharge`）
2. **会话管理**
   - 创建新会话（`/newConversation`）
   - 获取用户会话列表（`/getConversation`）
   - 查看历史消息（`/history`）
   - 分享会话（`/shareConversation/:id`）
   - 通过分享链接查看会话（`/share/:token`）
3. **文件管理**
   - 上传文件（`/upload`）
   - 获取文件（`/file/:id`）
4. **AI 生成接口**
   - 调用模型生成内容（`/generate`）
   - 图像马赛克生成（`/mosaic`）
5. **管理员功能**
   - 获取所有用户（`/admin/users`）
   - 添加用户
   - 修改用户信息
   - 删除用户
6. **辅助功能**
   - 打开本地浏览器访问页面（`/open`）
   - 获取模型列表（`/getModel`）

------

### 三、主要结构说明

#### 1. 数据结构（models）

- **User**：用户信息（包括邮箱、密码、会员状态、角色等）
- **Session**：用户登录会话（保存 token 和过期时间）
- **Conversation**：对话记录（支持分享）
- **FileRecord**：用户上传的文件记录
- **RequestBody / ResponseBody**：AI生成接口的请求与响应结构

#### 2. 工具函数

- `generateID()`：生成唯一 ID
- `generateToken()`：生成会话 token
- `hashPassword()`：加密密码
- `checkPasswordHash()`：验证密码
- `openBrowser(url string)`：在不同操作系统上打开浏览器

#### 3. 中间件

- `AuthMiddleware()`：验证用户登录状态
- `AdminMiddleware()`：验证管理员身份

------

### 四、项目运行

#### 1. 环境依赖

- Go 1.20+
- 数据库（MySQL / SQLite，根据 `initDB()` 设置）
- Gin 框架
- bcrypt（用于密码加密）

#### 2. 启动方式

```bash
go run main.go
```

默认监听端口：`8080`

#### 3. 访问示例

- 注册用户: `POST http://localhost:8080/register`
- 登录: `POST http://localhost:8080/login`
- 获取用户信息: `GET http://localhost:8080/getUserHandler`

------

### 五、数据库说明

数据库初始化在 `initDB()` 中完成，主要包含以下表：

- users（用户表）
- sessions（登录会话）
- conversations（对话记录）
- files（文件记录）

------

### 六、未来可扩展方向

- 增加多模型支持（如 GPT、Claude 等）
- 添加前端管理界面
- 增加 Redis 缓存加速
- 优化文件上传与清理机制
